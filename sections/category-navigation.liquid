<div class="missoma-category-nav-wrapper">
  <div class="missoma-category-nav">
    <div class="missoma-category-nav__container">
      <div class="missoma-category-nav__scroll">
        <div class="missoma-category-nav__items">
          {% for block in section.blocks %}
            <a href="{{ block.settings.link }}" class="missoma-category-nav__item" data-index="{{ forloop.index0 }}">
              {{ block.settings.title }}
            </a>
          {% endfor %}
        </div>
      </div>

      <button class="missoma-category-nav__arrow missoma-category-nav__arrow--prev" aria-label="Scroll left">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7 1L1 7L7 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <button class="missoma-category-nav__arrow missoma-category-nav__arrow--next" aria-label="Scroll right">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 1L7 7L1 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      {% if section.settings.show_dots %}
        <div class="missoma-category-nav__dots">
          {% for block in section.blocks %}
            <button
              class="missoma-category-nav__dot"
              data-index="{{ forloop.index0 }}"
              aria-label="Go to item {{ forloop.index }}"
            ></button>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
  .missoma-category-nav-wrapper {
    width: 100%;
    padding: 20px 0;
    background-color: {{ section.settings.background_color }};
  }

  .missoma-category-nav {
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .missoma-category-nav__container {
    position: relative;
  }

  .missoma-category-nav__scroll {
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    scroll-behavior: smooth;
  }

  .missoma-category-nav__scroll::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  .missoma-category-nav__items {
    display: flex;
    gap: {{ section.settings.gap }}px;
    padding: 5px 0;
    min-width: min-content;
  }

  .missoma-category-nav__item {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: {{ section.settings.button_height }}px;
    padding: 0 {{ section.settings.button_padding }}px;
    border-radius: 50px;
    border: 1px solid {{ section.settings.border_color }};
    background-color: {{ section.settings.button_background }};
    color: {{ section.settings.text_color }};
    font-family: {{ section.settings.font_family }};
    font-size: {{ section.settings.font_size }}px;
    font-weight: {{ section.settings.font_weight }};
    text-decoration: none;
    white-space: nowrap;
    transition: all 0.2s ease;
  }

  .missoma-category-nav__item:hover {
    background-color: {{ section.settings.button_hover_background }};
    color: {{ section.settings.text_hover_color }};
    border-color: {{ section.settings.border_hover_color }};
  }

  .missoma-category-nav__arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: {{ section.settings.arrow_background }};
    border: 1px solid {{ section.settings.border_color }};
    color: {{ section.settings.arrow_color }};
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2;
    transition: all 0.2s ease;
    opacity: 0;
    pointer-events: none;
  }

  .missoma-category-nav__arrow:hover {
    background-color: {{ section.settings.arrow_hover_background }};
    color: {{ section.settings.arrow_hover_color }};
  }

  .missoma-category-nav__arrow--prev {
    left: 0;
  }

  .missoma-category-nav__arrow--next {
    right: 0;
  }

  .missoma-category-nav__arrow.active {
    opacity: 1;
    pointer-events: auto;
  }

  /* Dots styling */
  .missoma-category-nav__dots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 15px;
  }

  .missoma-category-nav__dot {
    width: {{ section.settings.dot_size }}px;
    height: {{ section.settings.dot_size }}px;
    border-radius: 50%;
    background-color: {{ section.settings.dot_color }};
    border: none;
    padding: 0;
    cursor: pointer;
    opacity: 0.4;
    transition: all 0.2s ease;
  }

  .missoma-category-nav__dot:hover {
    opacity: 0.7;
  }

  .missoma-category-nav__dot.active {
    opacity: 1;
    background-color: {{ section.settings.dot_active_color }};
  }

  /* Responsive styles */
  @media screen and (max-width: 767px) {
    .missoma-category-nav {
      padding: 0 10px;
    }

    .missoma-category-nav__item {
      height: {{ section.settings.mobile_button_height }}px;
      padding: 0 {{ section.settings.mobile_button_padding }}px;
      font-size: {{ section.settings.mobile_font_size }}px;
    }

    .missoma-category-nav__arrow {
      width: 36px;
      height: 36px;
    }

    .missoma-category-nav__dot {
      width: {{ section.settings.mobile_dot_size }}px;
      height: {{ section.settings.mobile_dot_size }}px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const scrollContainer = document.querySelector('.missoma-category-nav__scroll');
    const prevButton = document.querySelector('.missoma-category-nav__arrow--prev');
    const nextButton = document.querySelector('.missoma-category-nav__arrow--next');
    const items = document.querySelectorAll('.missoma-category-nav__item');
    const dots = document.querySelectorAll('.missoma-category-nav__dot');

    // Get item positions for dot navigation
    const itemPositions = [];
    items.forEach(item => {
      itemPositions.push(item.offsetLeft);
    });

    // Set first dot as active initially
    if (dots.length > 0) {
      dots[0].classList.add('active');
    }

    // Check if scroll is needed and update arrow visibility
    function updateArrows() {
      const isScrollable = scrollContainer.scrollWidth > scrollContainer.clientWidth;
      const isScrolledToStart = scrollContainer.scrollLeft <= 10;
      const isScrolledToEnd = scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth - 10;

      if (isScrollable) {
        prevButton.classList.toggle('active', !isScrolledToStart);
        nextButton.classList.toggle('active', !isScrolledToEnd);
      } else {
        prevButton.classList.remove('active');
        nextButton.classList.remove('active');
      }
    }

    // Update active dot based on scroll position
    function updateActiveDot() {
      if (dots.length === 0) return;

      const scrollLeft = scrollContainer.scrollLeft;
      const containerWidth = scrollContainer.clientWidth;
      const scrollCenter = scrollLeft + (containerWidth / 2);

      // Find the closest item to the center of the viewport
      let closestIndex = 0;
      let closestDistance = Math.abs(itemPositions[0] - scrollCenter);

      for (let i = 1; i < itemPositions.length; i++) {
        const distance = Math.abs(itemPositions[i] - scrollCenter);
        if (distance < closestDistance) {
          closestDistance = distance;
          closestIndex = i;
        }
      }

      // Update active dot
      dots.forEach(dot => dot.classList.remove('active'));
      if (dots[closestIndex]) {
        dots[closestIndex].classList.add('active');
      }
    }

    // Scroll to item when dot is clicked
    dots.forEach(dot => {
      dot.addEventListener('click', function() {
        const index = parseInt(this.getAttribute('data-index'));
        const targetItem = items[index];

        if (targetItem) {
          const targetPosition = targetItem.offsetLeft - (scrollContainer.clientWidth - targetItem.offsetWidth) / 2;
          scrollContainer.scrollTo({
            left: targetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Scroll left/right when arrows are clicked
    prevButton.addEventListener('click', function() {
      scrollContainer.scrollBy({ left: -200, behavior: 'smooth' });
    });

    nextButton.addEventListener('click', function() {
      scrollContainer.scrollBy({ left: 200, behavior: 'smooth' });
    });

    // Update arrows and dots on scroll
    scrollContainer.addEventListener('scroll', function() {
      updateArrows();
      updateActiveDot();
    });

    // Update arrows and dots on resize
    window.addEventListener('resize', function() {
      // Recalculate item positions on resize
      items.forEach((item, index) => {
        itemPositions[index] = item.offsetLeft;
      });

      updateArrows();
      updateActiveDot();
    });

    // Initial check
    updateArrows();
    updateActiveDot();
  });
</script>

{% schema %}
{
  "name": "Category Navigation",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 800,
      "max": 1600,
      "step": 10,
      "label": "Max Width",
      "default": 1440
    },
    {
      "type": "range",
      "id": "gap",
      "min": 5,
      "max": 30,
      "step": 1,
      "label": "Gap Between Items",
      "default": 12
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "range",
      "id": "button_height",
      "min": 30,
      "max": 60,
      "step": 2,
      "label": "Button Height",
      "default": 40
    },
    {
      "type": "range",
      "id": "button_padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "label": "Button Padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "mobile_button_height",
      "min": 24,
      "max": 50,
      "step": 2,
      "label": "Mobile Button Height",
      "default": 36
    },
    {
      "type": "range",
      "id": "mobile_button_padding",
      "min": 8,
      "max": 30,
      "step": 2,
      "label": "Mobile Button Padding",
      "default": 16
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button Hover Background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_hover_color",
      "label": "Text Hover Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#e5e5e5"
    },
    {
      "type": "color",
      "id": "border_hover_color",
      "label": "Border Hover Color",
      "default": "#e5e5e5"
    },
    {
      "type": "header",
      "content": "Arrow Settings"
    },
    {
      "type": "color",
      "id": "arrow_background",
      "label": "Arrow Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_hover_background",
      "label": "Arrow Hover Background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "arrow_hover_color",
      "label": "Arrow Hover Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Dots Settings"
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show Dots Navigation",
      "default": true
    },
    {
      "type": "range",
      "id": "dot_size",
      "min": 6,
      "max": 16,
      "step": 1,
      "label": "Dot Size",
      "default": 8
    },
    {
      "type": "range",
      "id": "mobile_dot_size",
      "min": 4,
      "max": 12,
      "step": 1,
      "label": "Mobile Dot Size",
      "default": 6
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active Dot Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "text",
      "id": "font_family",
      "label": "Font Family",
      "default": "'Helvetica Neue', Helvetica, Arial, sans-serif"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "label": "Font Size",
      "default": 14
    },
    {
      "type": "range",
      "id": "mobile_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "label": "Mobile Font Size",
      "default": 13
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font Weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Regular"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "400"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Category Title",
          "default": "Category"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Category Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Category Navigation",
      "blocks": [
        {
          "type": "category",
          "settings": {
            "title": "Lucy Williams X Missoma",
            "link": "/collections/lucy-williams"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "14ct Solid Gold",
            "link": "/collections/14ct-solid-gold"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "Gifts Under Â£100",
            "link": "/collections/gifts-under-100"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "Most Gifted",
            "link": "/collections/most-gifted"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "Spotted On",
            "link": "/collections/spotted-on"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "Bracelets",
            "link": "/collections/bracelets"
          }
        },
        {
          "type": "category",
          "settings": {
            "title": "Mixed Metal Jewellery",
            "link": "/collections/mixed-metal"
          }
        }
      ]
    }
  ]
}
{% endschema %}
